<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">predvec</span>, <span class="var type1" id="S3T2U4">cgridvecprev</span>, <span class="var type1" id="S4T1U5">context</span>, <span class="var type1" id="S5T2U6">maxvec</span>] <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line">    <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line">    = occflow( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line">    <span class="var type1" id="S6T2U9">cgridvec</span>, <span class="mxinfo " id="T2:U6"><span class="mxinfo " id="T2:U7"><span class="var type1" id="S3T2U10">cgridvecprev</span></span></span>, <span class="mxinfo " id="T1:U9"><span class="mxinfo " id="T1:U10"><span class="var type1" id="S4T1U11">context</span></span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line">    , <span class="var type1" id="S7T1U12">nei_idx</span>, <span class="var type1" id="S8T1U13">nei_weight</span>, <span class="var type1" id="S9T3U14">nei_filter_n</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line">    , <span class="var type1" id="S10T1U15">nei4u_idx</span>, <span class="var type1" id="S11T1U16">nei4u_weight</span>, <span class="var type1" id="S12T3U17">nei4u_filter_n</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line">    , <span class="var type1" id="S13T3U18">occval</span> , <span class="var type1" id="S14T3U19">minthreshold</span>, <span class="var type1" id="S15T3U20">maxthreshold</span>, <span class="var type1" id="S16T3U21">reinitval</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line">    , <span class="var type1" id="S17T3U22">intensifyrate</span>, <span class="var type1" id="S18T3U23">nocc_attenuaterate</span>, <span class="var type1" id="S19T3U24">unknown_attenuaterate</span>, <span class="var type1" id="S20T3U25">sigm_coef</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line">    )</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% Occupancy flow with vector input</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% coder.extrinsic('clock')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% Compute indices first</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo " id="T2:U26"><span class="var type1" id="S21T2U28">newlyoccidx</span>  = <span class="mxinfo " id="T2:U28">find(<span class="mxinfo " id="T5:U29"><span class="mxinfo " id="T5:U30"><span class="var type1" id="S6T2U33">cgridvec</span> == <span class="var type1" id="S13T3U34">occval</span></span> &amp; <span class="mxinfo " id="T5:U33"><span class="var type1" id="S3T2U36">cgridvecprev</span> ~= <span class="var type1" id="S13T3U37">occval</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo " id="T3:U36"><span class="var type1" id="S23T3U40">nrnewlyocc</span>   = <span class="mxinfo " id="T3:U38">length(<span class="var type1" id="S21T2U43">newlyoccidx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo " id="T2:U40"><span class="var type1" id="S25T2U46">occidx</span>       = <span class="mxinfo " id="T2:U42">find(<span class="mxinfo " id="T5:U43"><span class="var type1" id="S6T2U50">cgridvec</span> == <span class="var type1" id="S13T3U51">occval</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo " id="T3:U46"><span class="var type1" id="S26T3U54">nrocc</span>        = <span class="mxinfo " id="T3:U48">length(<span class="var type1" id="S25T2U57">occidx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T2:U50"><span class="var type1" id="S27T2U60">noccidx</span>      = <span class="mxinfo " id="T2:U52">find(<span class="mxinfo " id="T5:U53"><span class="var type1" id="S6T2U64">cgridvec</span> ~= <span class="var type1" id="S13T3U65">occval</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo " id="T3:U56"><span class="var type1" id="S28T3U68">nrnocc</span>       = <span class="mxinfo " id="T3:U58">length(<span class="var type1" id="S27T2U71">noccidx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% 1 Intensify newly occupied cells</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% iclk = clock;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T3U74">j</span> = <span class="mxinfo " id="T3:U61">1</span>:<span class="var type1" id="S23T3U77">nrnewlyocc</span> <span class="comment">% For newly occupied cells</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">    <span class="mxinfo " id="T3:U63"><span class="var type1" id="S30T3U80">coccidx</span>  = <span class="mxinfo " id="T3:U65"><span class="var type1" id="S21T2U82">newlyoccidx</span>(<span class="var type1" id="S29T3U83">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">    <span class="mxinfo " id="T16:U68"><span class="var type1" id="S31T16U86">curr_col</span> = <span class="mxinfo " id="T16:U70"><span class="var type1" id="S4T1U88">context</span>(<span class="var type1" id="S30T3U89">coccidx</span>, <span class="mxinfo " id="T12:U73">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U74"><span class="mxinfo " id="T3:U75">max(<span class="var type1" id="S31T16U96">curr_col</span>)</span> &lt; <span class="var type1" id="S14T3U97">minthreshold</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line">        <span class="mxinfo " id="T16:U78"><span class="mxinfo " id="T16:U79"><span class="var type1" id="S4T1U101">context</span>(<span class="var type1" id="S30T3U102">coccidx</span>, <span class="mxinfo " id="T12:U82">:</span>)</span> = <span class="var type1" id="S16T3U104">reinitval</span></span>;        <span class="comment">% Reinitialize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line">        <span class="mxinfo " id="T16:U84"><span class="var type1" id="S33T16U108">updt_col</span> = <span class="mxinfo " id="T16:U86"><span class="var type1" id="S17T3U110">intensifyrate</span>*<span class="var type1" id="S31T16U111">curr_col</span></span></span>;      <span class="comment">% Intensify</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line">        <span class="mxinfo " id="T16:U89"><span class="var type1" id="S33T16U114">updt_col</span> = <span class="mxinfo " id="T16:U91">min(<span class="var type1" id="S33T16U117">updt_col</span>, <span class="var type1" id="S15T3U118">maxthreshold</span>)</span></span>; <span class="comment">% Max-thesholding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line">        <span class="mxinfo " id="T16:U94"><span class="mxinfo " id="T16:U95"><span class="var type1" id="S4T1U122">context</span>(<span class="var type1" id="S30T3U123">coccidx</span>, <span class="mxinfo " id="T12:U98">:</span>)</span> = <span class="var type1" id="S33T16U125">updt_col</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% ems_intensify = etime(clock, iclk)*1000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">% 2 Attenuate unoccupied cells</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% iclk = clock;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T3U128">j</span> = <span class="mxinfo " id="T3:U101">1</span>:<span class="var type1" id="S28T3U131">nrnocc</span> <span class="comment">% For unoccupied cells</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">    <span class="mxinfo " id="T3:U103"><span class="var type1" id="S35T3U134">cnoccidx</span> = <span class="mxinfo " id="T3:U105"><span class="var type1" id="S27T2U136">noccidx</span>(<span class="var type1" id="S29T3U137">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">    <span class="mxinfo " id="T16:U108"><span class="var type1" id="S31T16U140">curr_col</span> = <span class="mxinfo " id="T16:U110"><span class="var type1" id="S4T1U142">context</span>(<span class="var type1" id="S35T3U143">cnoccidx</span>, <span class="mxinfo " id="T12:U113">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">    <span class="mxinfo " id="T16:U114"><span class="var type1" id="S33T16U147">updt_col</span> = <span class="mxinfo " id="T16:U116"><span class="var type1" id="S31T16U149">curr_col</span>*<span class="var type1" id="S18T3U150">nocc_attenuaterate</span></span></span>;  <span class="comment">% Attenuate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">    <span class="mxinfo " id="T16:U119"><span class="mxinfo " id="T16:U120"><span class="var type1" id="S4T1U154">context</span>(<span class="var type1" id="S35T3U155">cnoccidx</span>, <span class="mxinfo " id="T12:U123">:</span>)</span> = <span class="var type1" id="S33T16U157">updt_col</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% ems_attenuate = etime(clock, iclk)*1000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">% 3 Propagation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">% iclk = clock;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T3U160">j</span> = <span class="mxinfo " id="T3:U126">1</span>:<span class="var type1" id="S26T3U163">nrocc</span> <span class="comment">% For occupied cells</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    <span class="mxinfo " id="T3:U128"><span class="var type1" id="S36T3U166">cpropidx</span>   = <span class="mxinfo " id="T3:U130"><span class="var type1" id="S25T2U168">occidx</span>(<span class="var type1" id="S29T3U169">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">    <span class="mxinfo " id="T16:U133"><span class="var type1" id="S31T16U172">curr_col</span>   = <span class="mxinfo " id="T16:U135"><span class="var type1" id="S4T1U174">context</span>(<span class="var type1" id="S36T3U175">cpropidx</span>, <span class="mxinfo " id="T12:U138">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">    <span class="mxinfo " id="T16:U139"><span class="var type1" id="S37T16U179">cneicon</span>    = <span class="mxinfo " id="T16:U141"><span class="var type1" id="S7T1U181">nei_idx</span>(<span class="var type1" id="S36T3U182">cpropidx</span>, <span class="mxinfo " id="T12:U144">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">    <span class="mxinfo " id="T16:U145"><span class="var type1" id="S38T16U186">cneiweight</span> = <span class="mxinfo " id="T16:U147"><span class="var type1" id="S8T1U188">nei_weight</span>(<span class="var type1" id="S36T3U189">cpropidx</span>, <span class="mxinfo " id="T12:U150">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S39T3U193">k</span> = <span class="mxinfo " id="T3:U152">1</span>:<span class="var type1" id="S9T3U196">nei_filter_n</span> <span class="comment">% For all neighbor cells</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">        <span class="mxinfo " id="T3:U154"><span class="var type1" id="S40T3U199">contextval</span> = <span class="mxinfo " id="T3:U156"><span class="var type1" id="S31T16U201">curr_col</span>(<span class="var type1" id="S39T3U202">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">        <span class="mxinfo " id="T3:U159"><span class="var type1" id="S41T3U205">neiidx</span>     = <span class="mxinfo " id="T3:U161"><span class="var type1" id="S37T16U207">cneicon</span>(<span class="var type1" id="S39T3U208">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">        <span class="mxinfo " id="T3:U164"><span class="var type1" id="S42T3U211">weightval</span>  = <span class="mxinfo " id="T3:U166"><span class="var type1" id="S38T16U213">cneiweight</span>(<span class="var type1" id="S39T3U214">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U169"><span class="var type1" id="S41T3U218">neiidx</span> ~= <span class="mxinfo " id="T3:U171">0</span></span> <span class="comment">% If properly connected, propagate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">            <span class="mxinfo " id="T3:U172"><span class="var type1" id="S43T3U222">origvontextval</span> = <span class="mxinfo " id="T3:U174"><span class="var type1" id="S4T1U224">context</span>(<span class="var type1" id="S41T3U225">neiidx</span>, <span class="var type1" id="S39T3U226">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">            <span class="mxinfo " id="T3:U178"><span class="var type1" id="S44T3U229">updtcontextval</span> = <span class="mxinfo " id="T3:U180"><span class="var type1" id="S42T3U231">weightval</span>*<span class="var type1" id="S40T3U232">contextval</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">            <span class="mxinfo " id="T3:U183"><span class="var type1" id="S44T3U235">updtcontextval</span> = <span class="mxinfo " id="T3:U185">min(<span class="var type1" id="S44T3U238">updtcontextval</span>, <span class="var type1" id="S15T3U239">maxthreshold</span>)</span></span>; <span class="comment">% Maximum value thresholding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">            <span class="mxinfo " id="T3:U188"><span class="mxinfo " id="T3:U189"><span class="var type1" id="S4T1U243">context</span>(<span class="var type1" id="S41T3U244">neiidx</span>, <span class="var type1" id="S39T3U245">k</span>)</span> = <span class="mxinfo " id="T3:U193">max(<span class="var type1" id="S43T3U248">origvontextval</span>, <span class="var type1" id="S44T3U249">updtcontextval</span>)</span></span>; <span class="comment">% Make sure current context propagation does not weaken the flow information</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">% ems_propagate = etime(clock, iclk)*1000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">% 4 Uncertainty in acceleration</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">% iclk = clock;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo " id="T1:U196"><span class="var type1" id="S45T1U252">tempcontext</span> = <span class="mxinfo " id="T1:U198">zeros(<span class="mxinfo " id="T19:U199">size(<span class="var type1" id="S4T1U257">context</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S39T3U260">k</span> = <span class="mxinfo " id="T3:U202">1</span>:<span class="mxinfo " id="T3:U203">size(<span class="var type1" id="S7T1U265">nei_idx</span>, 1)</span> <span class="comment">% For all cells</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T3U269">j</span> = <span class="mxinfo " id="T3:U206">1</span>:<span class="var type1" id="S9T3U272">nei_filter_n</span> <span class="comment">% For all context level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">        <span class="mxinfo " id="T3:U208"><span class="var type1" id="S48T3U275">sumval</span> = <span class="mxinfo " id="T3:U210">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S49T3U279">m</span> = <span class="mxinfo " id="T3:U212">1</span>:<span class="var type1" id="S12T3U282">nei4u_filter_n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">            <span class="mxinfo " id="T3:U214"><span class="var type1" id="S48T3U285">sumval</span> = <span class="mxinfo " id="T3:U216"><span class="var type1" id="S48T3U287">sumval</span> + <span class="mxinfo " id="T3:U218"><span class="mxinfo " id="T3:U219"><span class="var type1" id="S11T1U290">nei4u_weight</span>(<span class="var type1" id="S39T3U291">k</span>, <span class="var type1" id="S49T3U292">m</span>)</span>*<span class="mxinfo " id="T3:U223"><span class="var type1" id="S4T1U294">context</span>(<span class="mxinfo " id="T3:U225"><span class="var type1" id="S10T1U296">nei4u_idx</span>(<span class="var type1" id="S39T3U297">k</span>, <span class="var type1" id="S49T3U298">m</span>)</span>, <span class="var type1" id="S29T3U299">j</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">        <span class="mxinfo " id="T3:U230"><span class="mxinfo " id="T3:U231"><span class="var type1" id="S45T1U303">tempcontext</span>(<span class="var type1" id="S39T3U304">k</span>, <span class="var type1" id="S29T3U305">j</span>)</span> = <span class="var type1" id="S48T3U306">sumval</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo " id="T1:U236"><span class="var type1" id="S4T1U309">context</span> = <span class="var type1" id="S45T1U310">tempcontext</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">% ems_uia = etime(clock, iclk)*1000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">% 5 Prediction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% iclk = clock;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo " id="T2:U239"><span class="var type1" id="S5T2U313">maxvec</span>  = <span class="mxinfo " id="T2:U241"><span class="mxinfo " id="T16:U242">max(<span class="mxinfo " id="T1:U243"><span class="var type1" id="S4T1U318">context</span>'</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="mxinfo " id="T2:U245"><span class="var type1" id="S2T2U321">predvec</span> = <span class="mxinfo " id="T2:U247"><span class="fcn" id="F121N3:B323">sigm</span>(<span class="var type1" id="S5T2U324">maxvec</span>, <span class="var type1" id="S20T3U325">sigm_coef</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">% ems_predict = etime(clock, iclk)*1000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">% 6 Save previous grid</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo " id="T2:U250"><span class="var type1" id="S3T2U328">cgridvecprev</span> = <span class="var type1" id="S6T2U329">cgridvec</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    <span class="comment">%     fprintf('%.2f + %.2f + %.2f + %.2f + %.2f \n' <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">    <span class="comment">%         , ems_intensify, ems_attenuate, ems_propagate, ems_uia, ems_predict);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"></span></span>
</pre>
